
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pyquery.pyquery &#8212; pyquery 1.4.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pyquery 1.4.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pyquery.pyquery</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pyquery.pyquery</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2008 - Olivier Lauzanne &lt;olauzanne@gmail.com&gt;</span>
<span class="c1">#</span>
<span class="c1"># Distributed under the BSD license, see LICENSE.txt</span>
<span class="kn">from</span> <span class="nn">.cssselectpatch</span> <span class="kn">import</span> <span class="n">JQueryTranslator</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlencode</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urljoin</span>
<span class="kn">from</span> <span class="nn">.openers</span> <span class="kn">import</span> <span class="n">url_opener</span>
<span class="kn">from</span> <span class="nn">.text</span> <span class="kn">import</span> <span class="n">extract_text</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">import</span> <span class="nn">lxml.html</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="n">basestring</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">getargspec</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">args</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">POSITIONAL_OR_KEYWORD</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">with_camel_case_alias</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;decorator for methods who required a camelcase alias&quot;&quot;&quot;</span>
    <span class="n">_camel_case_aliases</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">func</span>


<span class="n">_camel_case_aliases</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">build_camel_case_aliases</span><span class="p">(</span><span class="n">PyQuery</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;add camelcase aliases to PyQuery&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">_camel_case_aliases</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">alias</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
        <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">PyQuery</span><span class="p">,</span> <span class="n">alias</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__code__</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">,</span>
                               <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__defaults__</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;Alias for :func:`~pyquery.pyquery.PyQuery.</span><span class="si">%s</span><span class="s1">`&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">PyQuery</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">PyQuery</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">fromstring</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">custom_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;use html parser if we don&#39;t have clean xml</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
        <span class="n">meth</span> <span class="o">=</span> <span class="s1">&#39;parse&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">meth</span> <span class="o">=</span> <span class="s1">&#39;fromstring&#39;</span>
    <span class="k">if</span> <span class="n">custom_parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">etree</span><span class="p">,</span> <span class="n">meth</span><span class="p">)(</span><span class="n">context</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">etree</span><span class="o">.</span><span class="n">XMLSyntaxError</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;seek&#39;</span><span class="p">):</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">lxml</span><span class="o">.</span><span class="n">html</span><span class="p">,</span> <span class="n">meth</span><span class="p">)(</span><span class="n">context</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">_ElementTree</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">getroot</span><span class="p">()]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">result</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">parser</span> <span class="o">==</span> <span class="s1">&#39;xml&#39;</span><span class="p">:</span>
            <span class="n">custom_parser</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">etree</span><span class="p">,</span> <span class="n">meth</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">parser</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
            <span class="n">custom_parser</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">lxml</span><span class="o">.</span><span class="n">html</span><span class="p">,</span> <span class="n">meth</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">parser</span> <span class="o">==</span> <span class="s1">&#39;html5&#39;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">lxml.html</span> <span class="kn">import</span> <span class="n">html5parser</span>
            <span class="n">custom_parser</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">html5parser</span><span class="p">,</span> <span class="n">meth</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">parser</span> <span class="o">==</span> <span class="s1">&#39;soup&#39;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">lxml.html</span> <span class="kn">import</span> <span class="n">soupparser</span>
            <span class="n">custom_parser</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">soupparser</span><span class="p">,</span> <span class="n">meth</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">parser</span> <span class="o">==</span> <span class="s1">&#39;html_fragments&#39;</span><span class="p">:</span>
            <span class="n">custom_parser</span> <span class="o">=</span> <span class="n">lxml</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">fragments_fromstring</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No such parser: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">parser</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">custom_parser</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">_ElementTree</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">getroot</span><span class="p">()]</span>
    <span class="k">elif</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">result</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[:</span><span class="n">func</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">NoDefault</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;clean representation in Sphinx&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;NoDefault&gt;&#39;</span>


<span class="n">no_default</span> <span class="o">=</span> <span class="n">NoDefault</span><span class="p">()</span>
<span class="k">del</span> <span class="n">NoDefault</span>


<span class="k">class</span> <span class="nc">FlexibleElement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;property to allow a flexible api&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pget</span><span class="p">,</span> <span class="n">pset</span><span class="o">=</span><span class="n">no_default</span><span class="p">,</span> <span class="n">pdel</span><span class="o">=</span><span class="n">no_default</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pget</span> <span class="o">=</span> <span class="n">pget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pset</span> <span class="o">=</span> <span class="n">pset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdel</span> <span class="o">=</span> <span class="n">pdel</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">klass</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">_element</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;real element to support set/get/del attr and item and js call</span>
<span class="sd">            style&quot;&quot;&quot;</span>
            <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pget</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="fm">__getattr__</span> <span class="o">=</span> <span class="fm">__getitem__</span> <span class="o">=</span> <span class="fm">__setattr__</span> <span class="o">=</span> <span class="fm">__setitem__</span> <span class="o">=</span> <span class="fm">__call__</span>

            <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">no_default</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdel</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
            <span class="fm">__delattr__</span> <span class="o">=</span> <span class="fm">__delitem__</span>

            <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="n">prop</span><span class="p">):</span>
                <span class="k">return</span> <span class="s1">&#39;&lt;flexible_element </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pget</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="n">_element</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">no_default</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pset</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>


<div class="viewcode-block" id="PyQuery"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery">[docs]</a><span class="k">class</span> <span class="nc">PyQuery</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The main class</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_translator_class</span> <span class="o">=</span> <span class="n">JQueryTranslator</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;parser&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;://&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">)):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s1">&#39;parent&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">no_default</span>

        <span class="k">if</span> <span class="s1">&#39;css_translator&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_translator</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;css_translator&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;xml&#39;</span><span class="p">,):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_translator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translator_class</span><span class="p">(</span><span class="n">xhtml</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">no_default</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_translator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_translator</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_translator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translator_class</span><span class="p">(</span><span class="n">xhtml</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">namespaces</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;namespaces&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># specific case to get the dom</span>
            <span class="k">if</span> <span class="s1">&#39;filename&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">html</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="s1">&#39;url&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;opener&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="n">opener</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;opener&#39;</span><span class="p">)</span>
                    <span class="n">html</span> <span class="o">=</span> <span class="n">opener</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">html</span> <span class="o">=</span> <span class="n">url_opener</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="s1">&#39;html&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_base_url</span> <span class="o">=</span> <span class="n">url</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid keyword arguments </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">)</span>

            <span class="n">elements</span> <span class="o">=</span> <span class="n">fromstring</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="p">)</span>
            <span class="c1"># close open descriptor if possible</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># get nodes</span>

            <span class="c1"># determine context and selector if any</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="n">context</span> <span class="o">=</span> <span class="n">no_default</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">context</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">selector</span><span class="p">,</span> <span class="n">context</span> <span class="o">=</span> <span class="n">args</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;You can&#39;t do that. Please, provide arguments&quot;</span><span class="p">)</span>

            <span class="c1"># get context</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">elements</span> <span class="o">=</span> <span class="n">fromstring</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">raise</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                <span class="c1"># copy</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="n">context</span><span class="p">[:]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="n">context</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">_Element</span><span class="p">):</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">context</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

            <span class="c1"># select nodes</span>
            <span class="k">if</span> <span class="n">elements</span> <span class="ow">and</span> <span class="n">selector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">no_default</span><span class="p">:</span>
                <span class="n">xpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_css_to_xpath</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
                <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="n">tag</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">xpath</span><span class="p">,</span> <span class="n">namespaces</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">namespaces</span><span class="p">))</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="n">results</span>

        <span class="nb">list</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_css_to_xpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;descendant-or-self::&#39;</span><span class="p">):</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[@&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translator</span><span class="o">.</span><span class="n">css_to_xpath</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;namespaces&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespaces</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return a new PyQuery instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You must provide at least a selector&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">([])</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)):</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="p">,)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># keep original list api prefixed with _</span>
    <span class="n">_append</span> <span class="o">=</span> <span class="nb">list</span><span class="o">.</span><span class="n">append</span>
    <span class="n">_extend</span> <span class="o">=</span> <span class="nb">list</span><span class="o">.</span><span class="n">extend</span>

    <span class="c1"># improve pythonic api</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">[:]</span> <span class="o">+</span> <span class="n">other</span><span class="p">[:])</span>

<div class="viewcode-block" id="PyQuery.extend"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extend with anoter PyQuery object&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extend</span><span class="p">(</span><span class="n">other</span><span class="p">[:])</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.items"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iter over elements. Return PyQuery objects:</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;div&gt;&lt;span&gt;foo&lt;/span&gt;&lt;span&gt;bar&lt;/span&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; [i.text() for i in d.items(&#39;span&#39;)]</span>
<span class="sd">            [&#39;foo&#39;, &#39;bar&#39;]</span>
<span class="sd">            &gt;&gt;&gt; [i.text() for i in d(&#39;span&#39;).items()]</span>
<span class="sd">            [&#39;foo&#39;, &#39;bar&#39;]</span>
<span class="sd">            &gt;&gt;&gt; list(d.items(&#39;a&#39;)) == list(d(&#39;a&#39;).items())</span>
<span class="sd">            True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">selector</span><span class="p">:</span>
            <span class="n">elems</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elems</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elems</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.xhtml_to_html"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.xhtml_to_html">[docs]</a>    <span class="k">def</span> <span class="nf">xhtml_to_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove xhtml namespace:</span>

<span class="sd">            &gt;&gt;&gt; doc = PyQuery(</span>
<span class="sd">            ...         &#39;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;/html&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; doc</span>
<span class="sd">            [&lt;{http://www.w3.org/1999/xhtml}html&gt;]</span>
<span class="sd">            &gt;&gt;&gt; doc.xhtml_to_html()</span>
<span class="sd">            [&lt;html&gt;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getroottree</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lxml</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">xhtml_to_html</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.remove_namespaces"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.remove_namespaces">[docs]</a>    <span class="k">def</span> <span class="nf">remove_namespaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove all namespaces:</span>

<span class="sd">            &gt;&gt;&gt; doc = PyQuery(&#39;&lt;foo xmlns=&quot;http://example.com/foo&quot;&gt;&lt;/foo&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; doc</span>
<span class="sd">            [&lt;{http://example.com/foo}foo&gt;]</span>
<span class="sd">            &gt;&gt;&gt; doc.remove_namespaces()</span>
<span class="sd">            [&lt;foo&gt;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getroottree</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s1">&#39;{*}*&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">):</span>
                    <span class="n">el</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;xml representation of current nodes::</span>

<span class="sd">            &gt;&gt;&gt; xml = PyQuery(</span>
<span class="sd">            ...   &#39;&lt;script&gt;&lt;![[CDATA[ ]&gt;&lt;/script&gt;&#39;, parser=&#39;html_fragments&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(str(xml))</span>
<span class="sd">            &lt;script&gt;&amp;lt;![[CDATA[ ]&amp;gt;&lt;/script&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;xml representation of current nodes&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__html__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;html representation of current nodes::</span>

<span class="sd">            &gt;&gt;&gt; html = PyQuery(</span>
<span class="sd">            ...   &#39;&lt;script&gt;&lt;![[CDATA[ ]&gt;&lt;/script&gt;&#39;, parser=&#39;html_fragments&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(html.__html__())</span>
<span class="sd">            &lt;script&gt;&lt;![[CDATA[ ]&gt;&lt;/script&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">lxml</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="ow">and</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span> <span class="ow">and</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nb">id</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
                <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;</span><span class="si">%s%s%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
            <span class="k">return</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return the xml root element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">no_default</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getroottree</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getroottree</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return the xml encoding of the root element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">docinfo</span><span class="o">.</span><span class="n">encoding</span>

    <span class="c1">##############</span>
    <span class="c1"># Traversing #</span>
    <span class="c1">##############</span>

    <span class="k">def</span> <span class="nf">_filter_only</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Filters the selection set only, as opposed to also including</span>
<span class="sd">           descendants.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">selector</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">elements</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_css_to_xpath</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="s1">&#39;self::&#39;</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">xpath</span><span class="p">,</span> <span class="n">namespaces</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">namespaces</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">unique</span><span class="p">:</span>
            <span class="n">result_list</span> <span class="o">=</span> <span class="n">results</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">result_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_only</span><span class="p">(</span>
            <span class="n">selector</span><span class="p">,</span>
            <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">],</span>
            <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_only</span><span class="p">(</span>
            <span class="n">selector</span><span class="p">,</span>
            <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">getprevious</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">getprevious</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_only</span><span class="p">(</span>
            <span class="n">selector</span><span class="p">,</span>
            <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">getnext</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">getnext</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_traverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">current</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">method</span><span class="p">)()</span>
            <span class="k">while</span> <span class="n">current</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">current</span>
                <span class="n">current</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">method</span><span class="p">)()</span>

    <span class="k">def</span> <span class="nf">_traverse_parent_topdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">this_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">current</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">this_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
            <span class="n">this_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">this_list</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">j</span>

    <span class="k">def</span> <span class="nf">_next_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traverse</span><span class="p">(</span><span class="s1">&#39;getnext&#39;</span><span class="p">)]</span>

<div class="viewcode-block" id="PyQuery.next_all"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.next_all">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">next_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; h = &#39;&lt;span&gt;&lt;p class=&quot;hello&quot;&gt;Hi&lt;/p&gt;&lt;p&gt;Bye&lt;/p&gt;&lt;img scr=&quot;&quot;/&gt;&lt;/span&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; d = PyQuery(h)</span>
<span class="sd">        &gt;&gt;&gt; d(&#39;p:last&#39;).next_all()</span>
<span class="sd">        [&lt;img&gt;]</span>
<span class="sd">        &gt;&gt;&gt; d(&#39;p:last&#39;).nextAll()</span>
<span class="sd">        [&lt;img&gt;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_only</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_all</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">_prev_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traverse</span><span class="p">(</span><span class="s1">&#39;getprevious&#39;</span><span class="p">)]</span>

<div class="viewcode-block" id="PyQuery.prev_all"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.prev_all">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">prev_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; h = &#39;&lt;span&gt;&lt;p class=&quot;hello&quot;&gt;Hi&lt;/p&gt;&lt;p&gt;Bye&lt;/p&gt;&lt;img scr=&quot;&quot;/&gt;&lt;/span&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; d = PyQuery(h)</span>
<span class="sd">        &gt;&gt;&gt; d(&#39;p:last&#39;).prev_all()</span>
<span class="sd">        [&lt;p.hello&gt;]</span>
<span class="sd">        &gt;&gt;&gt; d(&#39;p:last&#39;).prevAll()</span>
<span class="sd">        [&lt;p.hello&gt;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_only</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_all</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.siblings"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.siblings">[docs]</a>    <span class="k">def</span> <span class="nf">siblings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         &gt;&gt;&gt; h = &#39;&lt;span&gt;&lt;p class=&quot;hello&quot;&gt;Hi&lt;/p&gt;&lt;p&gt;Bye&lt;/p&gt;&lt;img scr=&quot;&quot;/&gt;&lt;/span&gt;&#39;</span>
<span class="sd">         &gt;&gt;&gt; d = PyQuery(h)</span>
<span class="sd">         &gt;&gt;&gt; d(&#39;.hello&#39;).siblings()</span>
<span class="sd">         [&lt;p&gt;, &lt;img&gt;]</span>
<span class="sd">         &gt;&gt;&gt; d(&#39;.hello&#39;).siblings(&#39;img&#39;)</span>
<span class="sd">         [&lt;img&gt;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_only</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_all</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_all</span><span class="p">())</span></div>

<div class="viewcode-block" id="PyQuery.parents"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.parents">[docs]</a>    <span class="k">def</span> <span class="nf">parents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; d = PyQuery(&#39;&lt;span&gt;&lt;p class=&quot;hello&quot;&gt;Hi&lt;/p&gt;&lt;p&gt;Bye&lt;/p&gt;&lt;/span&gt;&#39;)</span>
<span class="sd">        &gt;&gt;&gt; d(&#39;p&#39;).parents()</span>
<span class="sd">        [&lt;span&gt;]</span>
<span class="sd">        &gt;&gt;&gt; d(&#39;.hello&#39;).parents(&#39;span&#39;)</span>
<span class="sd">        [&lt;span&gt;]</span>
<span class="sd">        &gt;&gt;&gt; d(&#39;.hello&#39;).parents(&#39;p&#39;)</span>
<span class="sd">        []</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_only</span><span class="p">(</span>
            <span class="n">selector</span><span class="p">,</span>
            <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traverse_parent_topdown</span><span class="p">()],</span>
            <span class="n">unique</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.children"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.children">[docs]</a>    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Filter elements that are direct children of self using optional</span>
<span class="sd">        selector:</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;span&gt;&lt;p class=&quot;hello&quot;&gt;Hi&lt;/p&gt;&lt;p&gt;Bye&lt;/p&gt;&lt;/span&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d</span>
<span class="sd">            [&lt;span&gt;]</span>
<span class="sd">            &gt;&gt;&gt; d.children()</span>
<span class="sd">            [&lt;p.hello&gt;, &lt;p&gt;]</span>
<span class="sd">            &gt;&gt;&gt; d.children(&#39;.hello&#39;)</span>
<span class="sd">            [&lt;p.hello&gt;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">child</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tag</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_only</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.closest"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.closest">[docs]</a>    <span class="k">def</span> <span class="nf">closest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; d = PyQuery(</span>
<span class="sd">        ...  &#39;&lt;div class=&quot;hello&quot;&gt;&lt;p&gt;This is a &#39;</span>
<span class="sd">        ...  &#39;&lt;strong class=&quot;hello&quot;&gt;test&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">        &gt;&gt;&gt; d(&#39;strong&#39;).closest(&#39;div&#39;)</span>
<span class="sd">        [&lt;div.hello&gt;]</span>
<span class="sd">        &gt;&gt;&gt; d(&#39;strong&#39;).closest(&#39;.hello&#39;)</span>
<span class="sd">        [&lt;strong.hello&gt;]</span>
<span class="sd">        &gt;&gt;&gt; d(&#39;strong&#39;).closest(&#39;form&#39;)</span>
<span class="sd">        []</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">current</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">current</span><span class="p">)</span><span class="o">.</span><span class="n">is_</span><span class="p">(</span><span class="n">selector</span><span class="p">)):</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">current</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.contents"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.contents">[docs]</a>    <span class="k">def</span> <span class="nf">contents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return contents (with text nodes):</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;hello &lt;b&gt;bold&lt;/b&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d.contents()  # doctest: +ELLIPSIS</span>
<span class="sd">            [&#39;hello &#39;, &lt;Element b at ...&gt;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;child::text()|child::*&#39;</span><span class="p">,</span>
                           <span class="n">namespaces</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">namespaces</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.filter"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Filter elements in self using selector (string or function):</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;p class=&quot;hello&quot;&gt;Hi&lt;/p&gt;&lt;p&gt;Bye&lt;/p&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;)</span>
<span class="sd">            [&lt;p.hello&gt;, &lt;p&gt;]</span>
<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).filter(&#39;.hello&#39;)</span>
<span class="sd">            [&lt;p.hello&gt;]</span>
<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).filter(lambda i: i == 1)</span>
<span class="sd">            [&lt;p&gt;]</span>
<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).filter(lambda i: PyQuery(this).text() == &#39;Hi&#39;)</span>
<span class="sd">            [&lt;p.hello&gt;]</span>
<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).filter(lambda i, this: PyQuery(this).text() == &#39;Hi&#39;)</span>
<span class="sd">            [&lt;p.hello&gt;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_only</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">getargspec</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">this</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">selector</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">&#39;this&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">this</span>
                    <span class="k">if</span> <span class="n">callback</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">this</span><span class="p">):</span>
                        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">f_globals</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="vm">__globals__</span>
                <span class="k">if</span> <span class="s1">&#39;this&#39;</span> <span class="ow">in</span> <span class="n">f_globals</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">f_globals</span><span class="p">[</span><span class="s1">&#39;this&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.not_"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.not_">[docs]</a>    <span class="k">def</span> <span class="nf">not_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return elements that don&#39;t match the given selector:</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;p class=&quot;hello&quot;&gt;Hi&lt;/p&gt;&lt;p&gt;Bye&lt;/p&gt;&lt;div&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).not_(&#39;.hello&#39;)</span>
<span class="sd">            [&lt;p&gt;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">],</span>
                          <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.is_"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.is_">[docs]</a>    <span class="k">def</span> <span class="nf">is_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns True if selector matches at least one current element, else</span>
<span class="sd">        False:</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;p class=&quot;hello&quot;&gt;&lt;span&gt;Hi&lt;/span&gt;&lt;/p&gt;&lt;p&gt;Bye&lt;/p&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).eq(0).is_(&#39;.hello&#39;)</span>
<span class="sd">            True</span>

<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).eq(0).is_(&#39;span&#39;)</span>
<span class="sd">            False</span>

<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).eq(1).is_(&#39;.hello&#39;)</span>
<span class="sd">            False</span>

<span class="sd">        ..</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filter_only</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span></div>

<div class="viewcode-block" id="PyQuery.find"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find elements using selector traversing down from self:</span>

<span class="sd">            &gt;&gt;&gt; m = &#39;&lt;p&gt;&lt;span&gt;&lt;em&gt;Whoah!&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt; there&lt;/em&gt;&lt;/p&gt;&#39;</span>
<span class="sd">            &gt;&gt;&gt; d = PyQuery(m)</span>
<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).find(&#39;em&#39;)</span>
<span class="sd">            [&lt;em&gt;, &lt;em&gt;]</span>
<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).eq(1).find(&#39;em&#39;)</span>
<span class="sd">            [&lt;em&gt;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_css_to_xpath</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">xpath</span><span class="p">,</span> <span class="n">namespaces</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">namespaces</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span>
                   <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tag</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()]</span>
        <span class="c1"># Flatten the results</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.eq"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.eq">[docs]</a>    <span class="k">def</span> <span class="nf">eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return PyQuery of only the element with the provided index::</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;p class=&quot;hello&quot;&gt;Hi&lt;/p&gt;&lt;p&gt;Bye&lt;/p&gt;&lt;div&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).eq(0)</span>
<span class="sd">            [&lt;p.hello&gt;]</span>
<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).eq(1)</span>
<span class="sd">            [&lt;p&gt;]</span>
<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).eq(2)</span>
<span class="sd">            []</span>

<span class="sd">        ..</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Slicing will return empty list when index=-1</span>
        <span class="c1"># we should handle out of bound by ourselves</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.each"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.each">[docs]</a>    <span class="k">def</span> <span class="nf">each</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;apply func on each nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">func</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">&#39;this&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span>
                <span class="k">if</span> <span class="n">callback</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">f_globals</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__globals__</span>
            <span class="k">if</span> <span class="s1">&#39;this&#39;</span> <span class="ow">in</span> <span class="n">f_globals</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">f_globals</span><span class="p">[</span><span class="s1">&#39;this&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.map"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.map">[docs]</a>    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a new PyQuery after transforming current items with func.</span>

<span class="sd">        func should take two arguments - &#39;index&#39; and &#39;element&#39;.  Elements can</span>
<span class="sd">        also be referred to as &#39;this&#39; inside of func::</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;p class=&quot;hello&quot;&gt;Hi there&lt;/p&gt;&lt;p&gt;Bye&lt;/p&gt;&lt;br /&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).map(lambda i, e: PyQuery(e).text())</span>
<span class="sd">            [&#39;Hi there&#39;, &#39;Bye&#39;]</span>

<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).map(lambda i, e: len(PyQuery(this).text()))</span>
<span class="sd">            [8, 3]</span>

<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).map(lambda i, e: PyQuery(this).text().split())</span>
<span class="sd">            [&#39;Hi&#39;, &#39;there&#39;, &#39;Bye&#39;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">func</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">&#39;this&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">callback</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">f_globals</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__globals__</span>
            <span class="k">if</span> <span class="s1">&#39;this&#39;</span> <span class="ow">in</span> <span class="n">f_globals</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">f_globals</span><span class="p">[</span><span class="s1">&#39;this&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="PyQuery.end"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.end">[docs]</a>    <span class="k">def</span> <span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Break out of a level of traversal and return to the parent level.</span>

<span class="sd">            &gt;&gt;&gt; m = &#39;&lt;p&gt;&lt;span&gt;&lt;em&gt;Whoah!&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt; there&lt;/em&gt;&lt;/p&gt;&#39;</span>
<span class="sd">            &gt;&gt;&gt; d = PyQuery(m)</span>
<span class="sd">            &gt;&gt;&gt; d(&#39;p&#39;).eq(1).find(&#39;em&#39;).end().end()</span>
<span class="sd">            [&lt;p&gt;, &lt;p&gt;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span></div>

    <span class="c1">##############</span>
    <span class="c1"># Attributes #</span>
    <span class="c1">##############</span>
    <span class="k">def</span> <span class="nf">attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Attributes manipulation</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;class_&#39;</span><span class="p">:</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;for_&#39;</span><span class="p">:</span> <span class="s1">&#39;for&#39;</span><span class="p">}</span>

        <span class="n">attr</span> <span class="o">=</span> <span class="n">value</span> <span class="o">=</span> <span class="n">no_default</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">args</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">attr</span><span class="p">[</span><span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid arguments </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attr</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">tag</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">no_default</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">tag</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="PyQuery.remove_attr"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.remove_attr">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">remove_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove an attribute::</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;div id=&quot;myid&quot;&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d.remove_attr(&#39;id&#39;)</span>
<span class="sd">            [&lt;div&gt;]</span>
<span class="sd">            &gt;&gt;&gt; d.removeAttr(&#39;id&#39;)</span>
<span class="sd">            [&lt;div&gt;]</span>

<span class="sd">        ..</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">tag</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="n">attr</span> <span class="o">=</span> <span class="n">FlexibleElement</span><span class="p">(</span><span class="n">pget</span><span class="o">=</span><span class="n">attr</span><span class="p">,</span> <span class="n">pdel</span><span class="o">=</span><span class="n">remove_attr</span><span class="p">)</span>

    <span class="c1">#######</span>
    <span class="c1"># CSS #</span>
    <span class="c1">#######</span>
<div class="viewcode-block" id="PyQuery.height"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.height">[docs]</a>    <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">no_default</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set/get height of element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.width"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.width">[docs]</a>    <span class="k">def</span> <span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">no_default</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set/get width of element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.has_class"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.has_class">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">has_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if element has class::</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;div class=&quot;myclass&quot;&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d.has_class(&#39;myclass&#39;)</span>
<span class="sd">            True</span>
<span class="sd">            &gt;&gt;&gt; d.hasClass(&#39;myclass&#39;)</span>
<span class="sd">            True</span>

<span class="sd">        ..</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_</span><span class="p">(</span><span class="s1">&#39;.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.add_class"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.add_class">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">add_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a css class to elements::</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;div&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d.add_class(&#39;myclass&#39;)</span>
<span class="sd">            [&lt;div.myclass&gt;]</span>
<span class="sd">            &gt;&gt;&gt; d.addClass(&#39;myclass&#39;)</span>
<span class="sd">            [&lt;div.myclass&gt;]</span>

<span class="sd">        ..</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">classes</span> <span class="o">+=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">]</span>
            <span class="n">tag</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">classes</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.remove_class"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.remove_class">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">remove_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a css class to elements::</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;div class=&quot;myclass&quot;&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d.remove_class(&#39;myclass&#39;)</span>
<span class="sd">            [&lt;div&gt;]</span>
<span class="sd">            &gt;&gt;&gt; d.removeClass(&#39;myclass&#39;)</span>
<span class="sd">            [&lt;div&gt;]</span>

<span class="sd">        ..</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">classes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="n">classes</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">classes</span><span class="o">.</span><span class="n">difference_update</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
            <span class="n">classes</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">classes</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">tag</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">):</span>
                <span class="n">tag</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.toggle_class"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.toggle_class">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">toggle_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Toggle a css class to elements</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;div&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d.toggle_class(&#39;myclass&#39;)</span>
<span class="sd">            [&lt;div.myclass&gt;]</span>
<span class="sd">            &gt;&gt;&gt; d.toggleClass(&#39;myclass&#39;)</span>
<span class="sd">            [&lt;div&gt;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">values_to_add</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">]</span>
            <span class="n">values_to_del</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">]</span>
            <span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">classes</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values_to_del</span><span class="p">]</span>
            <span class="n">classes</span> <span class="o">+=</span> <span class="n">values_to_add</span>
            <span class="n">tag</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">classes</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">css</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;css attributes manipulation</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">attr</span> <span class="o">=</span> <span class="n">value</span> <span class="o">=</span> <span class="n">no_default</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid arguments </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">stripped_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
                                 <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">attr</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="n">current</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                           <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                           <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                           <span class="ow">and</span> <span class="ow">not</span> <span class="n">el</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">stripped_keys</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attr</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                <span class="n">tag</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">current</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">el</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span>
                        <span class="ow">not</span> <span class="n">el</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">attr</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
                <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                <span class="n">tag</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="n">css</span> <span class="o">=</span> <span class="n">FlexibleElement</span><span class="p">(</span><span class="n">pget</span><span class="o">=</span><span class="n">css</span><span class="p">,</span> <span class="n">pset</span><span class="o">=</span><span class="n">css</span><span class="p">)</span>

    <span class="c1">###################</span>
    <span class="c1"># CORE UI EFFECTS #</span>
    <span class="c1">###################</span>
<div class="viewcode-block" id="PyQuery.hide"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.hide">[docs]</a>    <span class="k">def</span> <span class="nf">hide</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove display:none to elements style:</span>

<span class="sd">            &gt;&gt;&gt; print(PyQuery(&#39;&lt;div style=&quot;display:none;&quot;/&gt;&#39;).hide())</span>
<span class="sd">            &lt;div style=&quot;display: none&quot;/&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.show"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add display:block to elements style:</span>

<span class="sd">            &gt;&gt;&gt; print(PyQuery(&#39;&lt;div /&gt;&#39;).show())</span>
<span class="sd">            &lt;div style=&quot;display: block&quot;/&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s1">&#39;block&#39;</span><span class="p">)</span></div>

    <span class="c1">########</span>
    <span class="c1"># HTML #</span>
    <span class="c1">########</span>
<div class="viewcode-block" id="PyQuery.val"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.val">[docs]</a>    <span class="k">def</span> <span class="nf">val</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">no_default</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the attribute value::</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;input /&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d.val(&#39;Youhou&#39;)</span>
<span class="sd">            [&lt;input&gt;]</span>

<span class="sd">        Get the attribute value::</span>

<span class="sd">            &gt;&gt;&gt; d.val()</span>
<span class="sd">            &#39;Youhou&#39;</span>

<span class="sd">        Set the selected values for a `select` element with the `multiple`</span>
<span class="sd">        attribute::</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&#39;&#39;</span>
<span class="sd">            ...             &lt;select multiple&gt;</span>
<span class="sd">            ...                 &lt;option value=&quot;you&quot;&gt;&lt;option value=&quot;hou&quot;&gt;</span>
<span class="sd">            ...             &lt;/select&gt;</span>
<span class="sd">            ...             &#39;&#39;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d.val([&#39;you&#39;, &#39;hou&#39;])</span>
<span class="sd">            [&lt;select&gt;]</span>

<span class="sd">        Get the selected values for a `select` element with the `multiple`</span>
<span class="sd">        attribute::</span>

<span class="sd">            &gt;&gt;&gt; d.val()</span>
<span class="sd">            [&#39;you&#39;, &#39;hou&#39;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">_get_value</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
            <span class="c1"># &lt;textarea&gt;</span>
            <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;textarea&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">()</span>
            <span class="c1"># &lt;select&gt;</span>
            <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;select&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;multiple&#39;</span> <span class="ow">in</span> <span class="n">tag</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="c1"># Only extract value if selected</span>
                    <span class="n">selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">tag</span><span class="p">)(</span><span class="s1">&#39;option[selected]&#39;</span><span class="p">)</span>
                    <span class="c1"># Rebuild list to avoid serialization error</span>
                    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">selected</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">_</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
                    <span class="p">))</span>
                <span class="n">selected_option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">tag</span><span class="p">)(</span><span class="s1">&#39;option[selected]:last&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">selected_option</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">selected_option</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">tag</span><span class="p">)(</span><span class="s1">&#39;option&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="c1"># &lt;input type=&quot;checkbox&quot;&gt; or &lt;input type=&quot;radio&quot;&gt;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_</span><span class="p">(</span><span class="s1">&#39;:checkbox,:radio&#39;</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;on&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">val</span>
            <span class="c1"># &lt;input&gt;</span>
            <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;input&#39;</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">val</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="c1"># everything else.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

        <span class="k">def</span> <span class="nf">_set_value</span><span class="p">(</span><span class="n">pq</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">pq</span><span class="p">:</span>
                <span class="c1"># &lt;select&gt;</span>
                <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;select&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>

                    <span class="k">def</span> <span class="nf">_make_option_selected</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
                        <span class="n">pq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">pq</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                            <span class="n">pq</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">,</span> <span class="s1">&#39;selected&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="s1">&#39;multiple&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tag</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                                <span class="k">del</span> <span class="n">value</span><span class="p">[:]</span>  <span class="c1"># Ensure it toggles first match</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">pq</span><span class="o">.</span><span class="n">removeAttr</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">tag</span><span class="p">)(</span><span class="s1">&#39;option&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="n">_make_option_selected</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="c1"># Stringify array</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="c1"># &lt;textarea&gt;</span>
                <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;textarea&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="c1"># &lt;input&gt; and everything else.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">no_default</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">_get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.html"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.html">[docs]</a>    <span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">no_default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get or set the html representation of sub nodes.</span>

<span class="sd">        Get the text value::</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;div&gt;&lt;span&gt;toto&lt;/span&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(d.html())</span>
<span class="sd">            &lt;span&gt;toto&lt;/span&gt;</span>

<span class="sd">        Extra args are passed to ``lxml.etree.tostring``::</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(d.html())</span>
<span class="sd">            &lt;span/&gt;</span>
<span class="sd">            &gt;&gt;&gt; print(d.html(method=&#39;html&#39;))</span>
<span class="sd">            &lt;span&gt;&lt;/span&gt;</span>

<span class="sd">        Set the text value::</span>

<span class="sd">            &gt;&gt;&gt; d.html(&#39;&lt;span&gt;Youhou !&lt;/span&gt;&#39;)</span>
<span class="sd">            [&lt;div&gt;]</span>
<span class="sd">            &gt;&gt;&gt; print(d)</span>
<span class="sd">            &lt;div&gt;&lt;span&gt;Youhou !&lt;/span&gt;&lt;/div&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">no_default</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">children</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">children</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tag</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">html</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;encoding&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">children</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">html</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                <span class="n">new_html</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">new_html</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">new_html</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tag</span><span class="o">.</span><span class="n">getchildren</span><span class="p">():</span>
                    <span class="n">tag</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">fromstring</span><span class="p">(</span>
                    <span class="sa">u</span><span class="s1">&#39;&lt;root&gt;&#39;</span> <span class="o">+</span> <span class="n">new_html</span> <span class="o">+</span> <span class="sa">u</span><span class="s1">&#39;&lt;/root&gt;&#39;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">children</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">children</span><span class="p">:</span>
                    <span class="n">tag</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
                <span class="n">tag</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">text</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.outer_html"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.outer_html">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">outer_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;html&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the html representation of the first selected element::</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;div&gt;&lt;span class=&quot;red&quot;&gt;toto&lt;/span&gt; rocks&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(d(&#39;span&#39;))</span>
<span class="sd">            &lt;span class=&quot;red&quot;&gt;toto&lt;/span&gt; rocks</span>
<span class="sd">            &gt;&gt;&gt; print(d(&#39;span&#39;).outer_html())</span>
<span class="sd">            &lt;span class=&quot;red&quot;&gt;toto&lt;/span&gt;</span>
<span class="sd">            &gt;&gt;&gt; print(d(&#39;span&#39;).outerHtml())</span>
<span class="sd">            &lt;span class=&quot;red&quot;&gt;toto&lt;/span&gt;</span>

<span class="sd">            &gt;&gt;&gt; S = PyQuery(&#39;&lt;p&gt;Only &lt;b&gt;me&lt;/b&gt; &amp; myself&lt;/p&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(S(&#39;b&#39;).outer_html())</span>
<span class="sd">            &lt;b&gt;me&lt;/b&gt;</span>

<span class="sd">        ..</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">e0</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">e0</span><span class="o">.</span><span class="n">tail</span><span class="p">:</span>
            <span class="n">e0</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">e0</span><span class="p">)</span>
            <span class="n">e0</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">e0</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyQuery.text"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.text">[docs]</a>    <span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">no_default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get or set the text representation of sub nodes.</span>

<span class="sd">        Get the text value::</span>

<span class="sd">            &gt;&gt;&gt; doc = PyQuery(&#39;&lt;div&gt;&lt;span&gt;toto&lt;/span&gt;&lt;span&gt;tata&lt;/span&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(doc.text())</span>
<span class="sd">            tototata</span>
<span class="sd">            &gt;&gt;&gt; doc = PyQuery(&#39;&#39;&#39;&lt;div&gt;&lt;span&gt;toto&lt;/span&gt;</span>
<span class="sd">            ...               &lt;span&gt;tata&lt;/span&gt;&lt;/div&gt;&#39;&#39;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(doc.text())</span>
<span class="sd">            toto tata</span>

<span class="sd">        Get the text value, without squashing newlines::</span>

<span class="sd">            &gt;&gt;&gt; doc = PyQuery(&#39;&#39;&#39;&lt;div&gt;&lt;span&gt;toto&lt;/span&gt;</span>
<span class="sd">            ...               &lt;span&gt;tata&lt;/span&gt;&lt;/div&gt;&#39;&#39;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(doc.text(squash_space=False))</span>
<span class="sd">            toto</span>
<span class="sd">            tata</span>

<span class="sd">        Set the text value::</span>

<span class="sd">            &gt;&gt;&gt; doc.text(&#39;Youhou !&#39;)</span>
<span class="sd">            [&lt;div&gt;]</span>
<span class="sd">            &gt;&gt;&gt; print(doc)</span>
<span class="sd">            &lt;div&gt;Youhou !&lt;/div&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">no_default</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">()</span> <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;textarea&#39;</span> <span class="k">else</span>
                <span class="n">extract_text</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tag</span><span class="o">.</span><span class="n">getchildren</span><span class="p">():</span>
                <span class="n">tag</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">tag</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="c1">################</span>
    <span class="c1"># Manipulating #</span>
    <span class="c1">################</span>

    <span class="k">def</span> <span class="nf">_get_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">fromstring</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&lt;root&gt;&#39;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="sa">u</span><span class="s1">&#39;&lt;/root&gt;&#39;</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">_Element</span><span class="p">):</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">PyQuery</span><span class="p">):</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s1">&#39;Value must be string, PyQuery or Element. Got </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">root_text</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">root_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="n">root</span><span class="p">,</span> <span class="n">root_text</span>

<div class="viewcode-block" id="PyQuery.append"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;append value to each nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root</span><span class="p">,</span> <span class="n">root_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_root</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if the tag has children</span>
                <span class="n">last_child</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">last_child</span><span class="o">.</span><span class="n">tail</span><span class="p">:</span>
                    <span class="n">last_child</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">last_child</span><span class="o">.</span><span class="n">tail</span> <span class="o">+=</span> <span class="n">root_text</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tag</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="n">tag</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">tag</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">root_text</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
            <span class="n">tag</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.append_to"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.append_to">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">append_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;append nodes to value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.prepend"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.prepend">[docs]</a>    <span class="k">def</span> <span class="nf">prepend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;prepend value to nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root</span><span class="p">,</span> <span class="n">root_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_root</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tag</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">tag</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">root</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">text</span>
                <span class="n">tag</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">root_text</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tag</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">root_text</span> <span class="o">+</span> <span class="n">tag</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
            <span class="n">tag</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">root</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">)]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.prepend_to"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.prepend_to">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">prepend_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;prepend nodes to value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.after"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.after">[docs]</a>    <span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;add value after nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root</span><span class="p">,</span> <span class="n">root_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_root</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tag</span><span class="o">.</span><span class="n">tail</span><span class="p">:</span>
                <span class="n">tag</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">tag</span><span class="o">.</span><span class="n">tail</span> <span class="o">+=</span> <span class="n">root_text</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">parent</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">root</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">parent</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">)]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.insert_after"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.insert_after">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">insert_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;insert nodes after value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.before"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.before">[docs]</a>    <span class="k">def</span> <span class="nf">before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;insert value before nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root</span><span class="p">,</span> <span class="n">root_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_root</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">getprevious</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">previous</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">previous</span><span class="o">.</span><span class="n">tail</span><span class="p">:</span>
                    <span class="n">previous</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">previous</span><span class="o">.</span><span class="n">tail</span> <span class="o">+=</span> <span class="n">root_text</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parent</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">root_text</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="n">parent</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">root</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">parent</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">)]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.insert_before"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.insert_before">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">insert_before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;insert nodes before value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.wrap"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.wrap">[docs]</a>    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A string of HTML that will be created on the fly and wrapped around</span>
<span class="sd">        each target:</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;span&gt;youhou&lt;/span&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d.wrap(&#39;&lt;div&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            [&lt;div&gt;]</span>
<span class="sd">            &gt;&gt;&gt; print(d)</span>
<span class="sd">            &lt;div&gt;&lt;span&gt;youhou&lt;/span&gt;&lt;/div&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">fromstring</span><span class="p">(</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">wrapper</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="c1"># FIXME: using iterchildren is probably not optimal</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">getchildren</span><span class="p">():</span>
                <span class="n">wrapper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">childs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">()]</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">childs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">child</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wrapper</span><span class="p">)</span>

            <span class="n">parent</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="n">tag</span><span class="p">:</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">addnext</span><span class="p">(</span><span class="n">wrapper</span><span class="p">)</span>
                        <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                        <span class="k">break</span>
        <span class="bp">self</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">nodes</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.wrap_all"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.wrap_all">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">wrap_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap all the elements in the matched set into a single wrapper</span>
<span class="sd">        element::</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;div&gt;&lt;span&gt;Hey&lt;/span&gt;&lt;span&gt;you !&lt;/span&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(d(&#39;span&#39;).wrap_all(&#39;&lt;div id=&quot;wrapper&quot;&gt;&lt;/div&gt;&#39;))</span>
<span class="sd">            &lt;div id=&quot;wrapper&quot;&gt;&lt;span&gt;Hey&lt;/span&gt;&lt;span&gt;you !&lt;/span&gt;&lt;/div&gt;</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;div&gt;&lt;span&gt;Hey&lt;/span&gt;&lt;span&gt;you !&lt;/span&gt;&lt;/div&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(d(&#39;span&#39;).wrapAll(&#39;&lt;div id=&quot;wrapper&quot;&gt;&lt;/div&gt;&#39;))</span>
<span class="sd">            &lt;div id=&quot;wrapper&quot;&gt;&lt;span&gt;Hey&lt;/span&gt;&lt;span&gt;you !&lt;/span&gt;&lt;/div&gt;</span>

<span class="sd">        ..</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">fromstring</span><span class="p">(</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">wrapper</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">getchildren</span><span class="p">():</span>
            <span class="n">child</span> <span class="o">=</span> <span class="n">wrapper</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">childs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">()]</span>
            <span class="n">child</span> <span class="o">=</span> <span class="n">childs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">replace_childs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">no_default</span>

        <span class="c1"># add nodes to wrapper and check parent</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">parent</span><span class="p">:</span>
                <span class="n">replace_childs</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># replace nodes i parent if possible</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">no_default</span> <span class="ow">and</span> <span class="n">replace_childs</span><span class="p">:</span>
            <span class="n">childs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">()]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">childs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wrapper</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrapper</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.replace_with"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.replace_with">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">replace_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;replace nodes by value:</span>

<span class="sd">            &gt;&gt;&gt; doc = PyQuery(&quot;&lt;html&gt;&lt;div /&gt;&lt;/html&gt;&quot;)</span>
<span class="sd">            &gt;&gt;&gt; node = PyQuery(&quot;&lt;span /&gt;&quot;)</span>
<span class="sd">            &gt;&gt;&gt; child = doc.find(&#39;div&#39;)</span>
<span class="sd">            &gt;&gt;&gt; child.replace_with(node)</span>
<span class="sd">            [&lt;div&gt;]</span>
<span class="sd">            &gt;&gt;&gt; print(doc)</span>
<span class="sd">            &lt;html&gt;&lt;span/&gt;&lt;/html&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">PyQuery</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">element</span><span class="p">)</span><span class="o">.</span><span class="n">before</span><span class="p">(</span>
                    <span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.replace_all"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.replace_all">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">replace_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;replace nodes by expr</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="n">no_default</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;replaceAll can only be used with an object with parent&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span><span class="o">.</span><span class="n">replace_with</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.clone"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return a copy of nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PyQuery</span><span class="p">([</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span></div>

<div class="viewcode-block" id="PyQuery.empty"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.empty">[docs]</a>    <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;remove nodes content</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">tag</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">tag</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.remove"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="n">no_default</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove nodes:</span>

<span class="sd">             &gt;&gt;&gt; h = (</span>
<span class="sd">             ... &#39;&lt;div&gt;Maybe &lt;em&gt;she&lt;/em&gt; does &lt;strong&gt;NOT&lt;/strong&gt; know&lt;/div&gt;&#39;</span>
<span class="sd">             ... )</span>
<span class="sd">             &gt;&gt;&gt; d = PyQuery(h)</span>
<span class="sd">             &gt;&gt;&gt; d(&#39;strong&#39;).remove()</span>
<span class="sd">             [&lt;strong&gt;]</span>
<span class="sd">             &gt;&gt;&gt; print(d)</span>
<span class="sd">             &lt;div&gt;Maybe &lt;em&gt;she&lt;/em&gt; does   know&lt;/div&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">expr</span> <span class="ow">is</span> <span class="n">no_default</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">tail</span><span class="p">:</span>
                        <span class="n">prev</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">getprevious</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">prev</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">parent</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                                <span class="n">parent</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="n">parent</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">tag</span><span class="o">.</span><span class="n">tail</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">prev</span><span class="o">.</span><span class="n">tail</span><span class="p">:</span>
                                <span class="n">prev</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="n">prev</span><span class="o">.</span><span class="n">tail</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">tag</span><span class="o">.</span><span class="n">tail</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="PyQuery.Fn"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.Fn">[docs]</a>    <span class="k">class</span> <span class="nc">Fn</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hook for defining custom function (like the jQuery.fn):</span>

<span class="sd">        .. sourcecode:: python</span>

<span class="sd">         &gt;&gt;&gt; fn = lambda: this.map(lambda i, el: PyQuery(this).outerHtml())</span>
<span class="sd">         &gt;&gt;&gt; PyQuery.fn.listOuterHtml = fn</span>
<span class="sd">         &gt;&gt;&gt; S = PyQuery(</span>
<span class="sd">         ...   &#39;&lt;ol&gt;   &lt;li&gt;Coffee&lt;/li&gt;   &lt;li&gt;Tea&lt;/li&gt;   &lt;li&gt;Milk&lt;/li&gt;   &lt;/ol&gt;&#39;)</span>
<span class="sd">         &gt;&gt;&gt; S(&#39;li&#39;).listOuterHtml()</span>
<span class="sd">         [&#39;&lt;li&gt;Coffee&lt;/li&gt;&#39;, &#39;&lt;li&gt;Tea&lt;/li&gt;&#39;, &#39;&lt;li&gt;Milk&lt;/li&gt;&#39;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">func</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">&#39;this&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">name</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">PyQuery</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span></div>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">Fn</span><span class="p">()</span>

    <span class="c1">########</span>
    <span class="c1"># AJAX #</span>
    <span class="c1">########</span>

<div class="viewcode-block" id="PyQuery.serialize_array"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.serialize_array">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">serialize_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Serialize form elements as an array of dictionaries, whose structure</span>
<span class="sd">        mirrors that produced by the jQuery API. Notably, it does not handle</span>
<span class="sd">        the deprecated `keygen` form element.</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;form&gt;&lt;input name=&quot;order&quot; value=&quot;spam&quot;&gt;&lt;/form&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d.serialize_array() == [{&#39;name&#39;: &#39;order&#39;, &#39;value&#39;: &#39;spam&#39;}]</span>
<span class="sd">            True</span>
<span class="sd">            &gt;&gt;&gt; d.serializeArray() == [{&#39;name&#39;: &#39;order&#39;, &#39;value&#39;: &#39;spam&#39;}]</span>
<span class="sd">            True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]},</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">serialize_pairs</span><span class="p">()</span>
        <span class="p">))</span></div>

<div class="viewcode-block" id="PyQuery.serialize"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.serialize">[docs]</a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Serialize form elements as a URL-encoded string.</span>

<span class="sd">            &gt;&gt;&gt; h = (</span>
<span class="sd">            ... &#39;&lt;form&gt;&lt;input name=&quot;order&quot; value=&quot;spam&quot;&gt;&#39;</span>
<span class="sd">            ... &#39;&lt;input name=&quot;order2&quot; value=&quot;baked beans&quot;&gt;&lt;/form&gt;&#39;</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; d = PyQuery(h)</span>
<span class="sd">            &gt;&gt;&gt; d.serialize()</span>
<span class="sd">            &#39;order=spam&amp;order2=baked%20beans&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">urlencode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serialize_pairs</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;%20&#39;</span><span class="p">)</span></div>

    <span class="c1">#####################################################</span>
    <span class="c1"># Additional methods that are not in the jQuery API #</span>
    <span class="c1">#####################################################</span>

<div class="viewcode-block" id="PyQuery.serialize_pairs"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.serialize_pairs">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">serialize_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Serialize form elements as an array of 2-tuples conventional for</span>
<span class="sd">        typical URL-parsing operations in Python.</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&lt;form&gt;&lt;input name=&quot;order&quot; value=&quot;spam&quot;&gt;&lt;/form&gt;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d.serialize_pairs()</span>
<span class="sd">            [(&#39;order&#39;, &#39;spam&#39;)]</span>
<span class="sd">            &gt;&gt;&gt; d.serializePairs()</span>
<span class="sd">            [(&#39;order&#39;, &#39;spam&#39;)]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># https://github.com/jquery/jquery/blob</span>
        <span class="c1"># /2d4f53416e5f74fa98e0c1d66b6f3c285a12f0ce/src/serialize.js#L14</span>
        <span class="n">_submitter_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="s1">&#39;button&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">]</span>

        <span class="n">controls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">([])</span>
        <span class="c1"># Expand list of form controls</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;form&#39;</span><span class="p">:</span>
                <span class="n">form_id</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">form_id</span><span class="p">:</span>
                    <span class="c1"># Include inputs outside of their form owner</span>
                    <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">getroot</span><span class="p">())</span>
                    <span class="n">controls</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">root</span><span class="p">(</span>
                        <span class="s1">&#39;#</span><span class="si">%s</span><span class="s1"> :not([form]):input, [form=&quot;</span><span class="si">%s</span><span class="s1">&quot;]:input&#39;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">form_id</span><span class="p">,</span> <span class="n">form_id</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">controls</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">el</span><span class="p">(</span><span class="s1">&#39;:not([form]):input&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;fieldset&#39;</span><span class="p">:</span>
                <span class="n">controls</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">el</span><span class="p">(</span><span class="s1">&#39;:input&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">controls</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
        <span class="c1"># Filter controls</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="s1">&#39;[name]:enabled:not(button)&#39;</span>  <span class="c1"># Not serializing image button</span>
        <span class="n">selector</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s1">&#39;:not([type=&quot;</span><span class="si">%s</span><span class="s1">&quot;])&#39;</span> <span class="o">%</span> <span class="n">s</span><span class="p">,</span>
            <span class="n">_submitter_types</span><span class="p">))</span>
        <span class="n">controls</span> <span class="o">=</span> <span class="n">controls</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_filter_out_unchecked</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
            <span class="n">el</span> <span class="o">=</span> <span class="n">controls</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">el</span><span class="o">.</span><span class="n">is_</span><span class="p">(</span><span class="s1">&#39;:checkbox:not(:checked)&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="n">el</span><span class="o">.</span><span class="n">is_</span><span class="p">(</span><span class="s1">&#39;:radio:not(:checked)&#39;</span><span class="p">)</span>
        <span class="n">controls</span> <span class="o">=</span> <span class="n">controls</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">_filter_out_unchecked</span><span class="p">)</span>

        <span class="c1"># jQuery serializes inputs with the datalist element as an ancestor</span>
        <span class="c1"># contrary to WHATWG spec as of August 2018</span>
        <span class="c1">#</span>
        <span class="c1"># xpath = &#39;self::*[not(ancestor::datalist)]&#39;</span>
        <span class="c1"># results = []</span>
        <span class="c1"># for tag in controls:</span>
        <span class="c1">#     results.extend(tag.xpath(xpath, namespaces=controls.namespaces))</span>
        <span class="c1"># controls = controls._copy(results)</span>

        <span class="c1"># Serialize values</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">val</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)),</span>
                    <span class="n">val</span>
                <span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">field</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="PyQuery.serialize_dict"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.serialize_dict">[docs]</a>    <span class="nd">@with_camel_case_alias</span>
    <span class="k">def</span> <span class="nf">serialize_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Serialize form elements as an ordered dictionary. Multiple values</span>
<span class="sd">        corresponding to the same input name are concatenated into one list.</span>

<span class="sd">            &gt;&gt;&gt; d = PyQuery(&#39;&#39;&#39;&lt;form&gt;</span>
<span class="sd">            ...             &lt;input name=&quot;order&quot; value=&quot;spam&quot;&gt;</span>
<span class="sd">            ...             &lt;input name=&quot;order&quot; value=&quot;eggs&quot;&gt;</span>
<span class="sd">            ...             &lt;input name=&quot;order2&quot; value=&quot;ham&quot;&gt;</span>
<span class="sd">            ...             &lt;/form&gt;&#39;&#39;&#39;)</span>
<span class="sd">            &gt;&gt;&gt; d.serialize_dict()</span>
<span class="sd">            OrderedDict([(&#39;order&#39;, [&#39;spam&#39;, &#39;eggs&#39;]), (&#39;order2&#39;, &#39;ham&#39;)])</span>
<span class="sd">            &gt;&gt;&gt; d.serializeDict()</span>
<span class="sd">            OrderedDict([(&#39;order&#39;, [&#39;spam&#39;, &#39;eggs&#39;]), (&#39;order2&#39;, &#39;ham&#39;)])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_pairs</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ret</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">val</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">base_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the url of current html document or None if not available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_url</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">no_default</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">base_url</span>

<div class="viewcode-block" id="PyQuery.make_links_absolute"><a class="viewcode-back" href="../../api.html#pyquery.pyquery.PyQuery.make_links_absolute">[docs]</a>    <span class="k">def</span> <span class="nf">make_links_absolute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make all links absolute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">base_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">base_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span>
            <span class="k">if</span> <span class="n">base_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span>
                    <span class="s1">&#39;You need a base URL to make your links&#39;</span>
                    <span class="s1">&#39;absolute. It can be provided by the base_url parameter.&#39;</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">repl</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
                <span class="n">attr_value</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
                <span class="c1"># when label hasn&#39;t such attr, pass</span>
                <span class="k">if</span> <span class="n">attr_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>

                <span class="c1"># skip specific &quot;protocol&quot; schemas</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">attr_value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
                       <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;tel:&#39;</span><span class="p">,</span> <span class="s1">&#39;callto:&#39;</span><span class="p">,</span> <span class="s1">&#39;sms:&#39;</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="kc">None</span>

                <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span>
                                    <span class="n">urljoin</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">attr_value</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
            <span class="k">return</span> <span class="n">rep</span>

        <span class="bp">self</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="n">repl</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="n">repl</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="n">repl</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="n">repl</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">(</span><span class="s1">&#39;iframe&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="n">repl</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="n">repl</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span></div></div>


<span class="n">build_camel_case_aliases</span><span class="p">(</span><span class="n">PyQuery</span><span class="p">)</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pyquery 1.4.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pyquery.pyquery</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2017, Olivier Lauzanne.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>